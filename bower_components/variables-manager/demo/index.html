<!doctype html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes">
  <title>variables-manager demo</title>
  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="../../iron-demo-helpers/demo-pages-shared-styles.html">
  <link rel="import" href="../../paper-input/paper-input.html">
  <link rel="import" href="../../paper-button/paper-button.html">
  <link rel="import" href="../../iron-form/iron-form.html">
  <link rel="import" href="../../paper-dropdown-menu/paper-dropdown-menu.html">
  <link rel="import" href="../../paper-listbox/paper-listbox.html">
  <link rel="import" href="../../paper-item/paper-item.html">
  <link rel="import" href="../variables-manager.html">

  <style is="custom-style" include="demo-pages-shared-styles">

    .vertical-section-container {
      max-width: 600px;
    }

    .env-name {
      margin-right: 8px;
    }

    .env-name:after {
      content: ',';
    }

  </style>
</head>
<body unresolved>
  <template is="dom-bind" id="app">
    <div class="vertical-section-container centered">
      <h3>The `variables-manager`</h3>
      <variables-manager></variables-manager>

      <h3>Available data</h3>
      <div class="preview">
        <div class="item">
          <span class="label">Current environment:</span>
          <span class="value">[[environment]]</span>
        </div>
        <div class="item">
          <span class="label">Variables in the environment:</span>
          <span class="value">
            <template is="dom-repeat" items="[[variables]]"><span class="env-name">[[item.variable]]</span></template>
          </span>
        </div>
        <div class="item">
          <span class="label">Available environments:</span>
          <span class="value">
            <template is="dom-repeat" items="[[environments]]"><span class="env-name">[[item.name]]</span></template>
          </span>
        </div>
      </div>
      <h3>Data editor</h3>
      <div class="editor">

        <h4>Add environment</h4>
        <form is="iron-form" id="addEnv">
          <paper-input name="name" label="Environment name"></paper-input>
          <paper-button on-tap="addEnv">Add environment</paper-button>
        </form>

        <h4>Remove environment</h4>
        <form is="iron-form" id="removeEnv">
          <paper-dropdown-menu name="name" label="Select environment">
            <paper-listbox class="dropdown-content" attr-for-selected="value">
              <template is="dom-repeat" items="[[environments]]">
                <paper-item value$="[[item.name]]">[[item.name]]</paper-item>
              </template>
            </paper-listbox>
          </paper-dropdown-menu>
          <paper-button on-tap="removeEnv">Remove environment</paper-button>
        </form>

        <h4>Select environment</h4>
        <form is="iron-form" id="selectEnv">
          <paper-dropdown-menu name="name" label="Select environment">
            <paper-listbox class="dropdown-content" attr-for-selected="value">
              <paper-item value="default">Default</paper-item>
              <template is="dom-repeat" items="[[environments]]">
                <paper-item value$="[[item.name]]">[[item.name]]</paper-item>
              </template>
            </paper-listbox>
          </paper-dropdown-menu>
          <paper-button on-tap="selectEnv">Select environment</paper-button>
        </form>

        <template is="dom-if" if="[[selectedEnvironment]]">
          <h4>Edit environment [[selectedEnvironment.name]]</h4>
          <form is="iron-form" id="updateEnv">
            <paper-input name="name" label="Environment name" value="{{selectedEnvironment.name}}"></paper-input>
            <paper-button on-tap="updateEnv">Update environment</paper-button>
          </form>
        </template>

        <h4>Add variable</h4>
        <form is="iron-form" id="addVar">
          <input type="hidden" name="environment" value$="[[environment]]"/>
          <paper-input name="variable" label="Variable name"></paper-input>
          <paper-input name="value" label="Variable body"></paper-input>
          <paper-button on-tap="addVar">Add variable</paper-button>
        </form>

        <template is="dom-if" if="[[hasVariables]]">
          <h4>Remove variable</h4>
          <form is="iron-form" id="removeVar">
            <paper-dropdown-menu name="variable" label="Select variable">
              <paper-listbox class="dropdown-content" attr-for-selected="value">
                <template is="dom-repeat" items="[[variables]]">
                  <paper-item value$="[[item.variable]]">[[item.variable]]</paper-item>
                </template>
              </paper-listbox>
            </paper-dropdown-menu>
            <paper-button on-tap="removeVar">Remove variable</paper-button>
          </form>

          <h4>Select variable</h4>
          <form is="iron-form" id="selectVar">
            <paper-dropdown-menu name="variable" label="Select variable">
              <paper-listbox class="dropdown-content" attr-for-selected="value">
                <template is="dom-repeat" items="[[variables]]">
                  <paper-item value$="[[item.variable]]">[[item.variable]]</paper-item>
                </template>
              </paper-listbox>
            </paper-dropdown-menu>
            <paper-button on-tap="selectVar">Select variable</paper-button>
          </form>
        </template>

        <template is="dom-if" if="[[selectedVariable]]">
          <h4>Edit variable</h4>
          <form is="iron-form" id="updateVar">
            <paper-input name="variable" label="Variable name" value="{{selectedVariable.variable}}"></paper-input>
            <paper-input name="value" label="Variable body" value="{{selectedVariable.value}}"></paper-input>
            <paper-button on-tap="updateVar">Update variable</paper-button>
          </form>
        </template>
      </div>
    </div>
  </template>
  <script>
  (function(scope) {
    function $(selector, node) {
      return (node ? node : document).querySelector(selector);
    }
    scope.environment = undefined;
    scope.variables = undefined;
    scope.environments = undefined;
    scope.selectedEnvironment = undefined;
    scope.hasVariables = false;
    scope.selectedVariable = undefined;

    document.addEventListener('selected-environment-changed', function(e) {
      var name = e.detail.value;
      scope.set('environment', name);
      if (name !== 'default') {
        var item = scope.environments.find(function(item) {
          return item.name === name;
        });
        scope.set('selectedEnvironment', undefined);
        scope.async(function() {
          scope.set('selectedEnvironment', item);
        }, 1);
      } else {
        scope.set('selectedEnvironment', false);
      }
    });

    document.addEventListener('variables-list-changed', function(e) {
      scope.set('variables', undefined);
      scope.hasVariables = false;
      scope.async(function() {
        scope.set('variables', e.detail.value);
        scope.hasVariables = !!(e.detail.value && e.detail.value.length);
      }, 1);
    });

    document.addEventListener('environments-list-changed', function(e) {
      scope.set('environments', undefined);
      scope.async(function() {
        scope.set('environments', e.detail.value);
      }, 1);
    });

    scope.addEnv = function() {
      var form = $('#addEnv');
      var values = form.serialize();
      if (!values.name) {
        return;
      }
      scope.fire('environment-updated', {
        value: values
      }, {
        cancelable: true,
        composed: true
      });
    };

    scope.removeEnv = function() {
      if (!scope.environments) {
        return;
      }
      var form = $('#removeEnv');
      var values = form.serialize();
      if (!values.name) {
        return;
      }
      // find the environment for it's ID
      var item = scope.environments.find(function(item) {
        return item.name === values.name;
      });
      if (!item) {
        return;
      }
      scope.fire('environment-deleted', {
        value: item._id
      }, {
        cancelable: true,
        composed: true
      });
      if (scope.selectedEnvironment._id === item._id) {
        scope.set('selectedEnvironment', false);
      }
    };

    scope.selectEnv = function() {
      if (!scope.environments) {
        return;
      }
      var form = $('#selectEnv');
      var values = form.serialize();
      if (!values.name) {
        return;
      }
      scope.fire('selected-environment-changed', {
        value: values.name
      }, {
        cancelable: true,
        composed: true
      });
    };
    scope.updateEnv = function() {
      scope.fire('environment-updated', {
        value: scope.selectedEnvironment
      }, {
        cancelable: true,
        composed: true
      });
      scope.set('selectedEnvironment', false);
    };

    scope.addVar = function() {
      var form = $('#addVar');
      var values = form.serialize();
      if (!values.variable) {
        return;
      }
      scope.fire('variable-updated', {
        value: values
      }, {
        cancelable: true,
        composed: true
      });
    };
    scope.selectVar = function() {
      if (!scope.variables) {
        return;
      }
      var form = $('#selectVar');
      var values = form.serialize();
      if (!values.variable) {
        return;
      }
      var item = scope.variables.find(function(item) {
        return item.variable === values.variable;
      });
      scope.set('selectedVariable', undefined);
      scope.async(function() {
        scope.set('selectedVariable', item);
      }, 1);
    };

    scope.updateVar = function() {
      scope.fire('variable-updated', {
        value: scope.selectedVariable
      }, {
        cancelable: true,
        composed: true
      });
      scope.set('selectedVariable', false);
    };

    scope.removeVar = function() {
      if (!scope.variables) {
        return;
      }
      var form = $('#removeVar');
      var values = form.serialize();
      if (!values.variable) {
        return;
      }
      // find the environment for it's ID
      var item = scope.variables.find(function(item) {
        return item.variable === values.variable;
      });
      if (!item) {
        return;
      }
      scope.fire('variable-deleted', {
        value: item._id
      }, {
        cancelable: true,
        composed: true
      });
      if (scope.selectedVariable._id === item._id) {
        scope.set('selectedVariable', false);
      }
    };
  })(document.getElementById('app'));
  </script>
</body>
</html>
